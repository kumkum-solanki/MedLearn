<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MedLearn</title>
  <style>
    :root{
      /* Custom palette from user */
      --p1: #dad7cd; /* light */
      --p2: #a3b18a; /* soft green */
      --p3: #588157; /* accent */
      --p4: #3a5a40; /* header */
      --p5: #344e41; /* card */

      --bg: linear-gradient(180deg, #0b1226, #071022);
      --text: #e6efe6;
      --muted: #cbd5c4;
      --radius: 14px;
      --shadow: 0 8px 24px rgba(20,20,20,.6);
      --glass: rgba(255,255,255,0.03);
      --ring: 0 0 0 4px rgba(88,129,87,.12);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: radial-gradient(800px 400px at 10% 10%, rgba(52,78,65,0.12), transparent 20%),
                  radial-gradient(700px 380px at 100% 0%, rgba(88,129,87,0.08), transparent 18%),
                  #071114; color:var(--text);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    header{background: linear-gradient(180deg,var(--p4), rgba(58,90,64,0.9)); padding:18px 0; border-bottom:1px solid rgba(255,255,255,0.03); position:sticky; top:0; z-index:20}
    .container{max-width:1200px; margin:0 auto; padding:0 20px}

    /* Top bar with centered title */
    .topbar{display:flex; align-items:center; justify-content:center; gap:18px}
    .brandbox{display:flex; align-items:center; gap:12px}
    .doctor-box{width:56px; height:56px; border-radius:12px; background: linear-gradient(180deg,var(--p2), var(--p3)); display:flex; align-items:center; justify-content:center; box-shadow: 0 6px 18px rgba(52,78,65,0.18);}
    .doctor-box svg{width:34px; height:34px; filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));}

    h1.title{font-size:1.35rem; margin:0; letter-spacing:0.2px; color: #f6fbf6}
    .top-controls{position:absolute; right:20px; top:22px; display:flex; gap:10px}

    main{padding:26px 0}
    .layout{display:grid; grid-template-columns: 1fr; gap:18px; max-width:1200px; margin:0 auto}

    .toolbar{display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap}
    .search{min-width:320px; max-width:560px; width:46%;}
    input[type='text'], select{background:transparent; border:1px solid rgba(255,255,255,0.06); padding:10px 12px; border-radius:10px; color:var(--text); outline:none}
    input[type='text']:focus, select:focus{box-shadow: var(--ring); border-color: var(--p3)}

    .btn{background:linear-gradient(180deg,var(--p3), var(--p2)); border:none; color:#07210a; padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer; box-shadow: var(--shadow);}
    .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--text); font-weight:600}
    .btn.secondary{background:linear-gradient(180deg,#2e4f3c,#2b3f35); color:var(--p1)}

    .panel{background: linear-gradient(180deg, rgba(52,78,65,0.06), rgba(52,78,65,0.03)); border:1px solid rgba(255,255,255,0.03); padding:18px; border-radius:16px; box-shadow: var(--shadow)}
    .grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(300px,1fr)); gap:16px}

    .card{background: linear-gradient(180deg, var(--p5), rgba(20,30,24,0.95)); border-radius:14px; padding:14px; border:1px solid rgba(255,255,255,0.03); box-shadow: 0 8px 26px rgba(10,18,12,0.5)}
    .card h4{margin:0 0 8px 0}
    .muted{color:var(--muted); font-size:0.95rem}
    .sep{height:1px; background: rgba(255,255,255,0.03); margin:10px 0}

    .actions{display:flex; gap:8px; justify-content:flex-end}
    .small{padding:6px 10px; font-size:0.95rem; border-radius:10px}

    /* Modal/dialog styles */
    dialog{border:none; border-radius:14px; padding:0; background: linear-gradient(180deg, rgba(20,30,24,0.95), rgba(14,22,18,0.95)); color:var(--text); width:min(820px,94vw);}
    dialog::backdrop{background:rgba(0,0,0,0.6)}
    .dlg-header{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,0.03)}
    .dlg-body{padding:16px}
    .grid-form{display:grid; grid-template-columns: 1fr 1fr; gap:12px}
    .grid-form .full{grid-column:1/-1}
    textarea{min-height:80px; resize:vertical}
    label{font-size:0.88rem; color:var(--muted);}

    /* Trash list */
    .trash-list{display:flex; flex-direction:column; gap:8px}
    .trash-item{background:rgba(0,0,0,0.12); border:1px solid rgba(255,255,255,0.03); padding:10px; border-radius:10px; display:flex; justify-content:space-between; align-items:center}

    /* Responsive tweaks */
    @media (max-width:900px){
      .search{width:100%}
      .toolbar{flex-direction:column; gap:12px}
      .grid{grid-template-columns: 1fr}
      .top-controls{display:none}
    }
  </style>
  <style>
  /* Add Medicine categories dropdown text green */
  #medCat {
    color: var(--p3); /* accent green */
  }

  /* Sort dropdown text green */
  #sort {
    color: var(--p3); /* accent green */
  }
</style>

</head>
<body>
  <header>
    <div class="container topbar">
      <div class="brandbox">
        <div class="doctor-box" title="Doctor">
          <!-- simple stethoscope SVG icon -->
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M4 7v5a4 4 0 0 0 8 0V7" />
            <path d="M12 12v4a3 3 0 0 0 6 0v-4" />
            <path d="M20 3v4" />
            <circle cx="20" cy="8" r="1.8" />
          </svg>
        </div>
        <div>
          <h1 class="title">MedLearn</h1>
        </div>
      </div>

      <div class="top-controls">
        <button class="btn" id="addMedBtn">‚ûï Add Medicine</button>
        <button class="btn secondary" id="catBtn">üóÇÔ∏è Categories</button>
        <button class="btn ghost" id="restoreBtn">‚ôªÔ∏è Restore</button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="layout">
      <div class="toolbar">
        <input id="q" class="search" type="text" placeholder="Search by name, content, use‚Ä¶" />
        <select id="sort" style="min-width:160px">
          <option value="name-asc">Sort: Name (A‚ÜíZ)</option>
          <option value="name-desc">Sort: Name (Z‚ÜíA)</option>
          <option value="cat-asc">Sort: Category</option>
        </select>
      </div>

      <section class="panel">
        <h3 style="margin-top:0">All Medicines</h3>
        <div id="cards" class="grid"></div>
        <div id="empty" class="muted" style="display:none; text-align:center; margin-top:20px">No medicines found. Add one with the <b>‚ûï Add Medicine</b> button.</div>
      </section>
    </div>
  </main>

  <!-- Add / Edit Medicine Dialog -->
  <dialog id="medDialog">
    <div class="dlg-header">
      <strong id="dlgTitle">Add Medicine</strong>
      <button class="btn ghost" onclick="closeMed()">‚úñ</button>
    </div>
    <div class="dlg-body">
      <form id="medForm" class="grid-form">
        <input type="hidden" id="medId" />
        <div>
          <label>Medicine Name</label>
          <input type="text" id="medName" required placeholder="e.g., Paracetamol" />
        </div>
        <div>
          <label>Category</label>
          <select id="medCat" required></select>
        </div>
        <div class="full">
          <label>Content / Composition</label>
          <input type="text" id="medContent" placeholder="e.g., Acetaminophen 500 mg" />
        </div>
        <div>
          <label>Dose</label>
          <input type="text" id="medDose" placeholder="e.g., 500 mg, 1 tablet q6h" />
        </div>
        <div>
          <label>Use (Indication)</label>
          <input type="text" id="medUse" placeholder="e.g., Fever, mild to moderate pain" />
        </div>
        <div class="full">
          <label>Notes (optional)</label>
          <textarea id="medNotes" placeholder="Contraindications, side effects, pregnancy, renal adjust‚Ä¶"></textarea>
        </div>
        <div class="full" style="display:flex; gap:8px; justify-content:flex-end">
          <button type="button" class="btn ghost" onclick="closeMed()">Cancel</button>
          <button type="submit" class="btn">Save Medicine</button>
        </div>
      </form>
    </div>
  </dialog>

  <!-- Categories Dialog -->
  <dialog id="catDialog">
    <div class="dlg-header">
      <strong>Manage Categories</strong>
      <button class="btn ghost" onclick="catDialog.close()">‚úñ</button>
    </div>
    <div class="dlg-body">
      <form id="catForm" class="grid-form">
        <div>
          <label>New Category</label>
          <input type="text" id="catInput" placeholder="e.g., Pain Relief" />
        </div>
        <div style="display:flex; align-items:flex-end">
          <button type="submit" class="btn">Add Category</button>
        </div>
      </form>
      <div id="catItems" style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap"></div>
    </div>
  </dialog>

  <!-- Restore (Trash) Dialog -->
  <dialog id="restoreDialog">
    <div class="dlg-header">
      <strong>Restore Deleted Medicines</strong>
      <button class="btn ghost" onclick="restoreDialog.close()">‚úñ</button>
    </div>
    <div class="dlg-body">
      <div id="trashList" class="trash-list"></div>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px">
        <button class="btn ghost" onclick="clearTrashConfirm()">Empty Trash</button>
        <button class="btn" onclick="restoreDialog.close()">Done</button>
      </div>
    </div>
  </dialog>

  <script>
  // Data layer with trash
  const STORE_KEY = 'medkb.v2';
  const defaultData = () => ({
    categories: [
      {id:'all', name:'All', locked:true},
      {id: id(), name:'Pain Relief'},
      {id: id(), name:'Antibiotics'},
      {id: id(), name:'Gastrointestinal'},
      {id: id(), name:'Respiratory'}
    ],
    medicines: [
      {id: id(), name:'Paracetamol', category:'', content:'Acetaminophen 500 mg', dose:'500 mg, 1 tab every 6‚Äì8h (max 3‚Äì4 g/day)', use:'Fever, mild‚Äìmoderate pain', notes:'Avoid >3 g/day in adults. Caution: liver disease.'},
      {id: id(), name:'Ibuprofen', category:'', content:'Ibuprofen 400 mg', dose:'200‚Äì400 mg every 8h with food', use:'Pain, inflammation', notes:'Avoid in late pregnancy; caution in GERD/ulcer, renal disease.'},
      {id: id(), name:'Amoxicillin', category:'', content:'Amoxicillin 500 mg', dose:'500 mg every 8h', use:'ENT, respiratory, UTI (susceptible)', notes:'Check penicillin allergy.'}
    ],
    trash: []
  });

  function load(){ try{ return JSON.parse(localStorage.getItem(STORE_KEY)) || defaultData(); } catch(e){ return defaultData(); } }
  function save(d){ localStorage.setItem(STORE_KEY, JSON.stringify(d)); }
  function id(){ return Math.random().toString(36).slice(2,9); }

  let state = load();
  let filter = { q:'', sort:'name-asc' };

  // Elements
  const cardsEl = document.getElementById('cards');
  const emptyEl = document.getElementById('empty');
  const medDialog = document.getElementById('medDialog');
  const catDialog = document.getElementById('catDialog');
  const restoreDialog = document.getElementById('restoreDialog');

  // Render
  function render(){
    let list = state.medicines.filter(m=>{
      const q = filter.q.trim().toLowerCase();
      return !q || `${m.name} ${m.content} ${m.use} ${m.notes||''}`.toLowerCase().includes(q);
    });
    if(filter.sort==='name-asc') list.sort((a,b)=>a.name.localeCompare(b.name));
    if(filter.sort==='name-desc') list.sort((a,b)=>b.name.localeCompare(a.name));
    if(filter.sort==='cat-asc') list.sort((a,b)=> (a.category||'').localeCompare(b.category||'') || a.name.localeCompare(b.name));

    cardsEl.innerHTML = '';
    list.forEach(m=> cardsEl.appendChild(card(m)));
    emptyEl.style.display = list.length? 'none' : 'block';
  }

  function card(m){
    const wrap = document.createElement('article'); wrap.className='card';
    const catName = (state.categories.find(c=>c.id===m.category)||{}).name || 'Uncategorized';
    wrap.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center">
        <div>
          <h4>${escapeHtml(m.name)}</h4>
          <div class="muted">${escapeHtml(catName)}</div>
        </div>
        <div style="display:flex; gap:8px">
          <button class="small btn ghost" data-act="edit">‚úèÔ∏è Edit</button>
          <button class="small btn ghost" data-act="del">üóëÔ∏è Delete</button>
        </div>
      </div>
      ${m.content? `<div class="sep"></div><div><span class="muted">Content:</span> ${escapeHtml(m.content)}</div>` : ''}
      ${m.dose? `<div><span class="muted">Dose:</span> ${escapeHtml(m.dose)}</div>` : ''}
      ${m.use? `<div><span class="muted">Use:</span> ${escapeHtml(m.use)}</div>` : ''}
      ${m.notes? `<div class="sep"></div><div class="muted">${escapeHtml(m.notes)}</div>` : ''}`
    ;
    wrap.querySelector('[data-act="edit"]').addEventListener('click', ()=> openMed(m));
    wrap.querySelector('[data-act="del"]').addEventListener('click', ()=> deleteMed(m.id));
    return wrap;
  }

  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  // Add/Edit
  function fillCatSelect(sel){ sel.innerHTML='';
    const cats = state.categories.filter(c=>c.id!=='all');
    if(!cats.length) sel.innerHTML = `<option value="">Uncategorized</option>`;
    cats.forEach(c=>{ const o = document.createElement('option'); o.value=c.id; o.textContent=c.name; sel.appendChild(o); });
  }

  function openMed(m){
    fillCatSelect(document.getElementById('medCat'));
    document.getElementById('dlgTitle').textContent = m? 'Edit Medicine' : 'Add Medicine';
    document.getElementById('medId').value = m? m.id : '';
    document.getElementById('medName').value = m? m.name : '';
    document.getElementById('medCat').value = m? (m.category||'') : '';
    document.getElementById('medContent').value = m? (m.content||'') : '';
    document.getElementById('medDose').value = m? (m.dose||'') : '';
    document.getElementById('medUse').value = m? (m.use||'') : '';
    document.getElementById('medNotes').value = m? (m.notes||'') : '';
    medDialog.showModal();
  }
  function closeMed(){ medDialog.close(); }

  document.getElementById('medForm').addEventListener('submit',(e)=>{
    e.preventDefault();
    const m = {
      id: document.getElementById('medId').value || id(),
      name: document.getElementById('medName').value.trim(),
      category: document.getElementById('medCat').value,
      content: document.getElementById('medContent').value.trim(),
      dose: document.getElementById('medDose').value.trim(),
      use: document.getElementById('medUse').value.trim(),
      notes: document.getElementById('medNotes').value.trim()
    };
    if(!m.name){ alert('Name is required'); return; }
    const idx = state.medicines.findIndex(x=>x.id===m.id);
    if(idx>=0) state.medicines[idx]=m; else state.medicines.push(m);
    save(state); render(); closeMed();
  });

  // Delete => move to trash
  function deleteMed(id_){
    const i = state.medicines.findIndex(x=>x.id===id_);
    if(i<0) return;
    const item = state.medicines.splice(i,1)[0];
    item._deletedAt = Date.now();
    state.trash.unshift(item);
    save(state); render();
    alert(`${item.name} moved to Trash. You can restore from Restore dialog.`);
  }

  // Restore dialog
  function openRestore(){
    const list = document.getElementById('trashList'); list.innerHTML='';
    if(!state.trash.length) { list.innerHTML = '<div class="muted">Trash is empty.</div>'; }
    state.trash.forEach(t=>{
      const el = document.createElement('div'); el.className='trash-item';
      el.innerHTML = `<div>${escapeHtml(t.name)} <div style="font-size:0.85rem;color:var(--muted)">${escapeHtml(t.use||'')}</div></div>
        <div style="display:flex; gap:8px">
          <button class="small btn ghost" data-act="del">Delete</button>
          <button class="small btn" data-act="restore">Restore</button>
        </div>`;
      el.querySelector('[data-act="del"]').addEventListener('click', ()=>{
        if(!confirm('Delete permanently?')) return;
        state.trash = state.trash.filter(x=>x.id!==t.id); save(state); openRestore();
      });
      el.querySelector('[data-act="restore"]').addEventListener('click', ()=>{
        state.trash = state.trash.filter(x=>x.id!==t.id); state.medicines.push(t); save(state); openRestore(); render();
      });
      list.appendChild(el);
    });
    restoreDialog.showModal();
  }

  function clearTrashConfirm(){ if(confirm('Are you sure? This will permanently delete all trashed items.')){ state.trash=[]; save(state); openRestore(); }}

  // Categories management
  function openCat(){ catDialog.showModal(); drawCatItems(); }
  function drawCatItems(){
    const container = document.getElementById('catItems'); container.innerHTML='';
    state.categories.filter(c=>!c.locked && c.id!=='all').forEach(c=>{
      const el = document.createElement('div'); el.className='card'; el.style.display='inline-flex'; el.style.padding='10px'; el.innerHTML = `<div style="min-width:160px">${escapeHtml(c.name)}</div><div style="display:flex;gap:8px"><button class="small btn ghost">‚úèÔ∏è</button><button class="small btn ghost">üóëÔ∏è</button></div>`;
      el.querySelectorAll('button')[0].addEventListener('click', ()=>{ const nv = prompt('Rename category', c.name); if(nv && nv.trim()){ c.name=nv.trim(); save(state); drawCatItems(); render(); }});
      el.querySelectorAll('button')[1].addEventListener('click', ()=>{ if(confirm('Delete category? Items will become Uncategorized.')){ state.medicines=state.medicines.map(m=> m.category===c.id? {...m, category:''} : m); state.categories=state.categories.filter(x=>x.id!==c.id); save(state); drawCatItems(); render(); }});
      container.appendChild(el);
    });
  }

  document.getElementById('catForm').addEventListener('submit',(e)=>{ e.preventDefault(); const name = document.getElementById('catInput').value.trim(); if(!name) return; state.categories.push({id:id(), name}); document.getElementById('catInput').value=''; save(state); drawCatItems(); render(); });

  // UI wiring
  document.getElementById('addMedBtn').addEventListener('click', ()=> openMed());
  document.getElementById('catBtn').addEventListener('click', ()=> openCat());
  document.getElementById('restoreBtn').addEventListener('click', ()=> openRestore());

  document.getElementById('q').addEventListener('input', (e)=>{ filter.q = e.target.value; render(); });
  document.getElementById('sort').addEventListener('change', (e)=>{ filter.sort = e.target.value; render(); });

  // Keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    if(e.altKey && (e.key==='n' || e.key==='N')){ e.preventDefault(); openMed(); }
    if(e.key==='Escape'){ medDialog.open && medDialog.close(); catDialog.open && catDialog.close(); restoreDialog.open && restoreDialog.close(); }
  });

  // init
  save(state); render();
  fillCatSelect(document.getElementById('medCat'));
  </script>
</body>
</html>
